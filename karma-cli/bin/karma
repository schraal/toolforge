#!/bin/sh

# First try to get some information about the
# current script
#
# First get some directory information and then
# the name of the script.
#
DIRNAME=`dirname $0`
PROGNAME=`basename $0`

# If the KARMA_HOME environment variable is not defined
# we make a best-guess
#
if [ "x$KARMA_HOME" = "x" ]; then
    # Get the full path (without any relative bits)
    #
    KARMA_HOME=`cd $DIRNAME/..; pwd`
fi
export KARMA_HOME


# Of course we need a JAVA_HOME, we're java programmers, aren't we?
#
if [ "x$JAVA_HOME" = "x" ]; then
    echo "JAVA_HOME is not defined, exiting..."
    exit 1
fi
JAVACMD=$JAVA_HOME/bin/java
export JAVACMD

# Please note the inclusion of tools.jar from the jdk.
#
JARS=`ls $KARMA_HOME/lib/*.jar`
CLASSPATH="$KARMA_HOME/resources"
for JAR in $JARS ; do
  CLASSPATH=$CLASSPATH:$JAR
done
CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/tools.jar

# Karma needs configuration files, we assume them in the $HOME/.karma directory
# and make sure the directory exists
#
if [ "x$KARMA_CONFIG_DIR" = "x" ]; then
	KARMA_CONFIG_DIR=`echo $HOME/.karma`
fi
export KARMA_CONFIG_DIR
mkdir -p $KARMA_CONFIG_DIR

if [ "x$1" = "x" ]; then
    LOGLEVEL=INFO
fi

#echo LOGLEVEL = $LOGLEVEL

# Now finally we are able to run karma
#
#$JAVACMD -cp $CLASSPATH -Dbootstrap.configuration=$HOME/.karma/karma.properties  -Druntime.mode=COMMAND_LINE nl.toolforge.karma.cli.CLI $@
$JAVACMD -Dkarma.home=$KARMA_HOME -Dloglevel=$LOGLEVEL -cp $CLASSPATH nl.toolforge.karma.cli.CLI $@




